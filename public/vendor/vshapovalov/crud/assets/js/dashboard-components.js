!function(e){var t={};function a(s){if(t[s])return t[s].exports;var l=t[s]={i:s,l:!1,exports:{}};return e[s].call(l.exports,l,l.exports,a),l.l=!0,l.exports}a.m=e,a.c=t,a.d=function(e,t,s){a.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:s})},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=0)}([function(e,t,a){e.exports=a(1)},function(e,t,a){Vue.component("fast-crud",a(2));var s={id:"fast-crud",name:"fast-crud",options:{isModal:!1,counterStartValue:100}};Bus.$on("user:fast-crud:mount",function(){return AdminManager.mountComponent(s,!0)})},function(e,t,a){var s=a(3)(a(4),a(5),!1,null,null,null);e.exports=s.exports},function(e,t){e.exports=function(e,t,a,s,l,o){var i,n=e=e||{},r=typeof e.default;"object"!==r&&"function"!==r||(i=e,n=e.default);var c,d="function"==typeof n?n.options:n;if(t&&(d.render=t.render,d.staticRenderFns=t.staticRenderFns,d._compiled=!0),a&&(d.functional=!0),l&&(d._scopeId=l),o?(c=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),s&&s.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(o)},d._ssrRegister=c):s&&(c=s),c){var f=d.functional,v=f?d.render:d.beforeCreate;f?(d._injectStyles=c,d.render=function(e,t){return c.call(t),v(e,t)}):d.beforeCreate=v?[].concat(v,c):[c]}return{esModule:i,exports:n,options:d}}},function(e,t,a){"use strict";function s(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"fast-crud",props:["options"],data:function(){return{activeTab:null,formActiveTab:null,formsPanel:null,tablesPanel:null,fieldsPanel:null,loading:!0,createModel:!1,tables:[],crudForms:[],form:{fields:[],scopes:[]},formTypes:["list","tree"],columnTypes:["checkbox","colorbox","datepicker","dropdown","image","textarea","textbox","richedit"],visibilityTypes:["browse","add","edit","hidden"],columnsWidthTypes:[12,6,4,3],jsonDialog:{formName:null,json:null,active:!1,onSubmit:null}}},computed:{jsonDialogHasOnSubmit:function(){return this.jsonDialog.onSubmit}},methods:{clearForm:function(){this.form={fields:[],scopes:[]}},saveForm:function(){var e=this;axios.post(App.baseUrl+"/"+App.crudPrefix+"/extra/forms",{form:this.form,createModel:this.createModel}).then(function(t){AdminManager.showInfo("Form created"),e.clearForm}).catch(function(e){AdminManager.showError(e)})},createFormFromJson:function(){var e=JSON.parse(this.jsonDialog.json);this.createFromForm(e)},jsonDialogSubmit:function(){this.jsonDialog.onSubmit&&this.jsonDialog.onSubmit()},showCreateFromJsonDialog:function(){var e=this;this.jsonDialog.formName="Paste json",this.jsonDialog.json=null,this.jsonDialog.onSubmit=function(){e.createFormFromJson(),e.jsonDialog.active=!1},this.jsonDialog.active=!0},addField:function(){this.form.fields.splice(0,0,{caption:"new field",name:"new field"})},addScope:function(){this.form.scopes.splice(0,0,{name:"new scope",code:"new scope"})},showFormJsonDialog:function(e){this.jsonDialog.formName=e.name,this.jsonDialog.json=JSON.stringify(e),this.jsonDialog.onSubmit=null,this.jsonDialog.active=!0},deleteField:function(e){this.form.fields=_.filter(this.form.fields,function(t){return t.name!=e.name})},deleteScope:function(e){this.form.scopes=_.filter(this.form.scope,function(t){return t.name!=e.name})},setIdField:function(e){this.form.id=e.name},setDisplayField:function(e){this.form.display=e.name},createFromForm:function(e){this.form=JSON.parse(JSON.stringify(e));var t=_.filter(this.form.fields,function(e){return e.isSelected});t.length&&(this.form.fields=t),_.each(this.form.fields,function(e){e.visibility=e.visibility?JSON.parse(e.visibility):[]}),this.activeTab=2},createFromTable:function(e){var t,a=!1,l=!1;this.form={code:e.name,name:e.name,fields:[],id:"id",display:"title",model:e.model,scopes:[]};var o=_.filter(e.columns,function(e){return e.isSelected}),i=_.map(o.length?o:e.columns,function(e,t){return"parent_id"==e.name&&(a=!0),"order"==e.name&&(l=!0),{name:e.name,caption:e.name,type:"timestamp"==e.type||"date"==e.type||"date"==e.type?"datepicker":"textbox",order:t,columns:6,description:null,validation:e.not_null?"required":null,visibility:["browse","add","edit"],by_default:e.default,json:0,readonly:0,tab:"Основные параметры",additional:""}});(t=this.form.fields).splice.apply(t,[0,this.form.fields.length].concat(s(i))),this.form.type=a&&l?"tree":"list",this.activeTab=2},compareValues:function(e,t){return e==t}},mounted:function(){var e=this;axios.get(App.baseUrl+"/"+App.crudPrefix+"/extra/tables").then(function(t){var a;(a=e.tables).splice.apply(a,[0,0].concat(s(t.data)))}).catch(function(e){AdminManager.showError(e)}),axios.get(App.baseUrl+"/"+App.crudPrefix+"/extra/forms").then(function(t){var a;(a=e.crudForms).splice.apply(a,[0,0].concat(s(t.data)))}).catch(function(e){AdminManager.showError(e)})}}},function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-layout",{staticStyle:{position:"relative"},attrs:{column:"","fill-height":""}},[a("v-flex",{staticClass:"layout row wrap mb-1"},[a("v-tabs",{staticClass:"flex xs12",model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[a("v-tab",{key:0},[e._v("Tables")]),e._v(" "),a("v-tab",{key:1},[e._v("Crud forms")]),e._v(" "),a("v-tab",{key:2},[e._v("Add form")])],1)],1),e._v(" "),a("v-flex",{staticStyle:{position:"relative"},attrs:{"fill-height":""}},[a("div",{staticClass:"scroll-container"},[a("v-tabs-items",{model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[a("v-tab-item",{key:0,staticClass:"py-2"},[a("v-expansion-panel",{attrs:{inset:""},model:{value:e.tablesPanel,callback:function(t){e.tablesPanel=t},expression:"tablesPanel"}},e._l(e.tables,function(t,s){return a("v-expansion-panel-content",{key:s},[a("div",{attrs:{slot:"header"},slot:"header"},[e._v(e._s(t.name)+" ("+e._s(t.columns.length)+" columns(s))")]),e._v(" "),e.tablesPanel==s?[a("v-list",e._l(t.columns,function(t){return a("v-list-tile",{key:t.name},[a("v-list-tile-content",[a("v-list-tile-title",[e._v(e._s(t.name))]),e._v(" "),a("v-list-tile-sub-title",[e._v("type: "+e._s(t.type)+", length: "+e._s(t.length)+", not null: "+e._s(t.not_null)+", default: "+e._s(t.default))])],1),e._v(" "),a("v-flex",{staticStyle:{"flex-grow":"0"}},[a("v-checkbox",{model:{value:t.isSelected,callback:function(a){e.$set(t,"isSelected",a)},expression:"column.isSelected"}})],1)],1)})),e._v(" "),a("div",[a("v-btn",{attrs:{flat:"",color:"success"},on:{click:function(a){e.createFromTable(t)}}},[e._v("make form")])],1)]:e._e()],2)}))],1),e._v(" "),a("v-tab-item",{key:1,staticClass:"py-2"},[a("v-expansion-panel",{attrs:{inset:""},model:{value:e.formsPanel,callback:function(t){e.formsPanel=t},expression:"formsPanel"}},e._l(e.crudForms,function(t,s){return a("v-expansion-panel-content",{key:s},[a("div",{attrs:{slot:"header"},slot:"header"},[e._v(e._s(t.name)+" ("+e._s(t.fields.length)+" fields(s))")]),e._v(" "),e.formsPanel==s?[a("v-list",e._l(t.fields,function(t){return a("v-list-tile",{key:t.name},[a("v-list-tile-content",[a("v-list-tile-title",[e._v(e._s(t.name)+" ("+e._s(t.caption)+")")]),e._v(" "),a("v-list-tile-sub-title",[e._v("type: "+e._s(t.type)+", validation: "+e._s(t.validation)+", by_default: "+e._s(t.by_default))])],1),e._v(" "),a("v-flex",{staticStyle:{"flex-grow":"0"}},[a("v-checkbox",{model:{value:t.isSelected,callback:function(a){e.$set(t,"isSelected",a)},expression:"field.isSelected"}})],1)],1)})),e._v(" "),a("div",[a("v-btn",{attrs:{flat:"",color:"success"},on:{click:function(a){e.createFromForm(t)}}},[e._v("make form")]),e._v(" "),a("v-btn",{attrs:{flat:"",color:"accent"},on:{click:function(a){e.showFormJsonDialog(t)}}},[e._v("json")])],1)]:e._e()],2)}))],1),e._v(" "),a("v-tab-item",{key:2,staticClass:"py-2 px-2"},[a("v-layout",[a("v-flex",{attrs:{xs12:"",md3:""}},[a("p",{staticClass:"headline"},[e._v("Form settings")]),e._v(" "),a("v-text-field",{attrs:{label:"caption"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}}),e._v(" "),a("v-text-field",{attrs:{label:"code"},model:{value:e.form.code,callback:function(t){e.$set(e.form,"code",t)},expression:"form.code"}}),e._v(" "),a("v-text-field",{attrs:{label:"model"},model:{value:e.form.model,callback:function(t){e.$set(e.form,"model",t)},expression:"form.model"}}),e._v(" "),a("v-text-field",{attrs:{label:"id field"},model:{value:e.form.id,callback:function(t){e.$set(e.form,"id",t)},expression:"form.id"}}),e._v(" "),a("v-text-field",{attrs:{label:"display field"},model:{value:e.form.display,callback:function(t){e.$set(e.form,"display",t)},expression:"form.display"}}),e._v(" "),a("v-select",{attrs:{label:"type",items:e.formTypes},model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}}),e._v(" "),a("v-checkbox",{attrs:{label:"Create model"},model:{value:e.createModel,callback:function(t){e.createModel=t},expression:"createModel"}}),e._v(" "),a("v-btn",{attrs:{block:"",flat:"",color:"success"},on:{click:e.saveForm}},[e._v("Save form")]),e._v(" "),a("v-btn",{attrs:{block:"",flat:"",color:"accent"},on:{click:e.showCreateFromJsonDialog}},[e._v("From json")])],1),e._v(" "),a("v-flex",{attrs:{xs12:"",md9:""}},[a("v-tabs",{model:{value:e.formActiveTab,callback:function(t){e.formActiveTab=t},expression:"formActiveTab"}},[a("v-tab",{key:"fields"},[e._v("Fields")]),e._v(" "),a("v-tab",{key:"scopes"},[e._v("Scopes")])],1),e._v(" "),a("v-tabs-items",{model:{value:e.formActiveTab,callback:function(t){e.formActiveTab=t},expression:"formActiveTab"}},[a("v-tab-item",{key:"fields",staticClass:"py-2"},[a("div",{},[a("v-btn",{attrs:{flat:"",color:"success"},on:{click:e.addField}},[e._v("Add field")])],1),e._v(" "),a("v-expansion-panel",{attrs:{inset:""},model:{value:e.fieldsPanel,callback:function(t){e.fieldsPanel=t},expression:"fieldsPanel"}},e._l(e.form.fields,function(t,s){return a("v-expansion-panel-content",{key:s},[a("div",{attrs:{slot:"header"},slot:"header"},[e._v(e._s(t.caption)+"("+e._s(t.name)+")")]),e._v(" "),e.fieldsPanel==s?[a("v-card",[a("v-card-text",{staticClass:"layout ro wrap"},[a("v-flex",{attrs:{xs12:""}},[a("v-btn",{attrs:{flat:"",color:"red"},on:{click:function(a){e.deleteField(t)}}},[e._v("Delete")]),e._v(" "),a("v-btn",{attrs:{flat:"",color:"accent"},on:{click:function(a){e.setIdField(t)}}},[e._v("Set as id")]),e._v(" "),a("v-btn",{attrs:{flat:"",color:"accent"},on:{click:function(a){e.setDisplayField(t)}}},[e._v("Set as display")])],1),e._v(" "),a("v-flex",{staticClass:"px-1 py-1",attrs:{xs12:"",md6:""}},[a("v-text-field",{attrs:{label:"name"},model:{value:t.name,callback:function(a){e.$set(t,"name",a)},expression:"field.name"}})],1),e._v(" "),a("v-flex",{staticClass:"px-1 py-1",attrs:{xs12:"",md6:""}},[a("v-text-field",{attrs:{label:"caption"},model:{value:t.caption,callback:function(a){e.$set(t,"caption",a)},expression:"field.caption"}})],1),e._v(" "),a("v-flex",{staticClass:"px-1 py-1",attrs:{xs12:"",md6:""}},[a("v-select",{attrs:{label:"type",items:e.columnTypes},model:{value:t.type,callback:function(a){e.$set(t,"type",a)},expression:"field.type"}})],1),e._v(" "),a("v-flex",{staticClass:"px-1 py-1",attrs:{xs12:"",md6:""}},[a("v-select",{attrs:{label:"visibility",items:e.visibilityTypes,multiple:!0},model:{value:t.visibility,callback:function(a){e.$set(t,"visibility",a)},expression:"field.visibility"}})],1),e._v(" "),a("v-flex",{staticClass:"px-1 py-1",attrs:{xs12:"",md6:""}},[a("v-text-field",{attrs:{label:"by_default"},model:{value:t.by_default,callback:function(a){e.$set(t,"by_default",a)},expression:"field.by_default"}})],1),e._v(" "),a("v-flex",{staticClass:"px-1 py-1",attrs:{xs12:"",md6:""}},[a("v-text-field",{attrs:{label:"description"},model:{value:t.description,callback:function(a){e.$set(t,"description",a)},expression:"field.description"}})],1),e._v(" "),a("v-flex",{staticClass:"px-1 py-1",attrs:{xs12:"",md6:""}},[a("v-text-field",{attrs:{label:"tab"},model:{value:t.tab,callback:function(a){e.$set(t,"tab",a)},expression:"field.tab"}})],1),e._v(" "),a("v-flex",{staticClass:"px-1 py-1",attrs:{xs12:"",md6:""}},[a("v-text-field",{attrs:{label:"validation"},model:{value:t.validation,callback:function(a){e.$set(t,"validation",a)},expression:"field.validation"}})],1),e._v(" "),a("v-flex",{staticClass:"px-1 py-1",attrs:{xs12:""}},[a("v-textarea",{attrs:{label:"additional"},model:{value:t.additional,callback:function(a){e.$set(t,"additional",a)},expression:"field.additional"}})],1),e._v(" "),a("v-flex",{staticClass:"px-1 py-1",attrs:{xs12:"",md4:""}},[a("v-select",{attrs:{label:"columns",items:e.columnsWidthTypes,"value-comparator":e.compareValues},model:{value:t.columns,callback:function(a){e.$set(t,"columns",a)},expression:"field.columns"}})],1),e._v(" "),a("v-flex",{staticClass:"px-1 py-1",attrs:{xs12:"",md4:""}},[a("v-checkbox",{attrs:{label:"json"},model:{value:t.json,callback:function(a){e.$set(t,"json",a)},expression:"field.json"}})],1),e._v(" "),a("v-flex",{staticClass:"px-1 py-1",attrs:{xs12:"",md4:""}},[a("v-text-field",{attrs:{label:"order"},model:{value:t.order,callback:function(a){e.$set(t,"order",a)},expression:"field.order"}})],1)],1)],1)]:e._e()],2)}))],1),e._v(" "),a("v-tab-item",{key:"scopes",staticClass:"py-2"},[a("div",{},[a("v-btn",{attrs:{flat:"",color:"success"},on:{click:e.addScope}},[e._v("Add scope")])],1),e._v(" "),a("v-expansion-panel",{attrs:{inset:""}},e._l(e.form.scopes,function(t,s){return a("v-expansion-panel-content",{key:s},[a("div",{attrs:{slot:"header"},slot:"header"},[e._v(e._s(t.name))]),e._v(" "),a("v-card",[a("v-card-text",{staticClass:"layout ro wrap"},[a("v-flex",{attrs:{xs12:""}},[a("v-btn",{attrs:{flat:"",color:"red"},on:{click:function(a){e.deleteScope(t)}}},[e._v("Delete")])],1),e._v(" "),a("v-flex",{staticClass:"px-1 py-1",attrs:{xs12:""}},[a("v-text-field",{attrs:{label:"name"},model:{value:t.name,callback:function(a){e.$set(t,"name",a)},expression:"scope.name"}})],1)],1)],1)],1)}))],1)],1)],1)],1)],1)],1)],1)]),e._v(" "),a("v-dialog",{attrs:{width:"600px"},model:{value:e.jsonDialog.active,callback:function(t){e.$set(e.jsonDialog,"active",t)},expression:"jsonDialog.active"}},[a("v-card",[a("v-card-title",[a("span",{staticClass:"headline"},[e._v("JSON of form ["+e._s(e.jsonDialog.formName)+"]")])]),e._v(" "),a("v-card-text",[a("v-textarea",{attrs:{height:"300px"},model:{value:e.jsonDialog.json,callback:function(t){e.$set(e.jsonDialog,"json",t)},expression:"jsonDialog.json"}})],1),e._v(" "),a("v-card-actions",[a("v-spacer"),e._v(" "),a("v-btn",{directives:[{name:"show",rawName:"v-show",value:e.jsonDialogHasOnSubmit,expression:"jsonDialogHasOnSubmit"}],attrs:{flat:""},on:{click:e.jsonDialogSubmit}},[e._v("Ok")]),e._v(" "),a("v-btn",{attrs:{flat:""},on:{click:function(t){e.jsonDialog.active=!1}}},[e._v("Close")])],1)],1)],1)],1)},staticRenderFns:[]}}]);